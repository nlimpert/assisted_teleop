<launch>
  <include file="$(find pr2_machine)/$(env ROBOT).machine" />

  <!-- Bring up the mux that will switch between teleop and navigation commands. TODO: When mux is fixed, remove slash infront of topic names so that things can be pushed into a namespace -->
  <node pkg="topic_tools" type="mux" name="cmd_vel_mux" respawn="true" args="base_controller/command /navigation/cmd_vel /teleop/cmd_vel">
    <remap from="mux" to="cmd_vel_mux" />
  </node>

  <!-- Bring up teleoperation -->
  <node pkg="pr2_teleop" type="teleop_pr2" name="teleop_pr2" respawn="true" machine="c2">
    <remap from="cmd_vel" to="teleop/cmd_vel" />

    <!-- Axes -->
    <param name="axis_vx" value="3" type="int"/>
    <param name="axis_vy" value="2" type="int"/>
    <param name="axis_vw" value="0" type="int"/>
    <param name="axis_pan" value="0" type="int"/>
    <param name="axis_tilt" value="3" type="int"/>

    <!-- Base velocities -->
    <param name="max_vw" value="0.8" />
    <param name="max_vx" value="0.5" />
    <param name="max_vy" value="0.5" />
    <param name="max_vw_run" value="1.4" />
    <param name="max_vx_run" value="1.0" />
    <param name="max_vy_run" value="1.0" />
 
    <!-- Head -->
    <param name="max_pan" value="2.7" />
    <param name="max_tilt" value="1.4" />
    <param name="min_tilt" value="-0.4" />
    <param name="tilt_step" value="0.3" />
    <param name="pan_step" value="0.3" />

    <!-- Buttons have changed for PS3 controller mapping -->
    <!-- With joystick remapper, this works with all joysticks on "/joy" -->
    <param name="run_button" value="11" type="int" />
    <param name="torso_dn_button" value="14" type="int" />
    <param name="torso_up_button" value="12" type="int" />
    <param name="head_button" value="8" type="int" />
    <param name="deadman_button" value="10" type="int"/>
  </node>

  <include file="$(find pr2_navigation_perception)/lasers_and_filters.xml" />
  <include file="$(find pr2_navigation_perception)/ground_plane.xml" />

  <!-- Throttle the voxel grid that is being published for rviz -->
  <node ns="assisted_teleop/costmap" name="voxel_grid_throttle" pkg="topic_tools" type="throttle" args="messages voxel_grid 3.0 voxel_grid_throttled" />

  <node pkg="assisted_teleop" type="assisted_teleop" name="assisted_teleop" output="screen">
    <remap from="odom" to="base_odometry/odom" />
    <remap from="teleop_cmd_vel" to="teleop/cmd_vel" />
    <remap from="cmd_vel" to="navigation/cmd_vel" />

    <!-- Load common configuration files -->
    <rosparam file="$(find pr2_navigation_config)/move_base/move_base_params.yaml" command="load" />
    <rosparam file="$(find pr2_navigation_config)/move_base/costmap_common_params.yaml" command="load" ns="costmap" />
    <rosparam file="$(find pr2_navigation_config)/move_base/base_local_planner_params.yaml" command="load" ns="planner" />

    <!-- Load assisted teleop specific parameters -->
    <rosparam file="$(find assisted_teleop)/launch/pr2_costmap_params.yaml" command="load" />
  </node>

</launch>
